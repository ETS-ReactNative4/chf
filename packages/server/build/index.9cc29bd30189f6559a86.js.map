{"version":3,"file":"index.60dbf6fc7fe6fc7f0cce.hot-update.js","sources":["/Users/austinreynolds/Documents/MOD/chf-rcomm/packages/client/src/modules/admin/components/Seo/index.js"],"sourcesContent":["import React from 'react';\nimport PropTypes from 'prop-types';\nimport { graphql, compose, withApollo } from 'react-apollo';\nimport { compose as Rcompose } from 'ramda';\n// import classnames from 'classnames';\n// import { Formik, Field, Form } from 'formik';\n// import { MdClose, MdSave } from 'react-icons/md';\nimport '../../../profile/styles/manage-specs.scss';\n\nimport Loader from '../../../common/components/global/components/Loader';\nimport SeoForm from './SeoForm';\n\nimport '../../styles/forms.scss';\nimport VENDORS_QUERY from '../../../common/graphql/VendorsQuery.graphql';\n\nimport PRODUCT_SEO_QUERY from '../../graphql/ProductSeoQuery.graphql';\nimport UPLOAD_SEO_CONTENT from '../../graphql/UploadSeoContent.graphql';\nimport COLLECTIONS_QUERY from '../../graphql/CollectionsQuery.graphql';\nimport VENDOR_SEO_QUERY from '../../graphql/VendorSeoQuery.graphql';\nimport COLLECTION_SEO_QUERY from '../../graphql/CollectionSeoQuery.graphql';\nimport UPLOAD_SEO from '../../graphql/UploadSeo.graphql';\n\n// import PRODUCT_DATA_QUERY from '../../../common/graphql/ProductDataQuery.graphql';\nimport ADD_PRODUCT_DATA from '../../../common/graphql/AddProductData.graphql';\nimport UPDATE_PRODUCT_DATA from '../../../common/graphql/UpdateProductData.graphql';\nimport { ADMIN_PRODUCTS_QUERY, MODIFY_PRODUCT_DATA } from '../../../common/schema';\n// import { prodFeatures, prodSpecs } from '../../../products/components/SingleProductView';\n\nconst selectProdString = 'Select a product';\nconst selectSpecString = 'Select a specification';\nconst selectContent = 'Select a category';\nconst selectBrandString = 'Select a brand';\nconst selectCollectionString = 'Select a collection';\n// const fullSpecs = [...prodSpecs, ...prodFeatures];\nconst clearedSubmissionResult = { submissionError: null, submissionSuccess: null };\n\nclass ManageSeo extends React.Component {\n  state = {\n    currentEdit: {},\n    selectedProduct: selectProdString,\n    selectedBrand: selectBrandString,\n    selectedCollection: selectCollectionString,\n    selectedSpec: selectSpecString,\n    selectedCategory: selectContent,\n    currentCategoryValues: null,\n    categories: ['Products', 'Brands', 'Collections'],\n    specInput: '',\n    submissionError: null,\n    submissionSuccess: null\n  };\n\n  componentDidUpdate(prevProps, prevState) {\n    // const { selectedCategory } = this.state;\n    if (prevState.selectedProduct !== this.state.selectedProduct) {\n      this.loadProductSeo(this.state.selectedProduct);\n    }\n    if (this.state.selectedCategory === 'brands' && prevState.selectedBrand !== this.state.selectedBrand) {\n      this.loadBrandSeo(this.state.selectedBrand);\n      // console.log('brand', brand);\n    }\n    if (\n      this.state.selectedCategory === 'collections' &&\n      prevState.selectedCollection !== this.state.selectedCollection\n    ) {\n      this.loadCollectionSeo(this.state.selectedCollection);\n    }\n    // if (prevState.selectedCategory !== selectedCategory) {\n    //   console.log('SELECTED CAT IS DIFF', selectedCategory);\n    //   // const { productsLoading, sfy_shop, productData } = this.props;\n    //   console.log('THE PROPS::', this.props);\n    // }\n  }\n  loadProductSeo = async handle => {\n    const {\n      data: { productData }\n    } = await this.props.refetchProductData({ handle });\n    console.log('PRODUCT', productData);\n    this.setState({ currentCategoryValues: productData.seo });\n  };\n  loadCollectionSeo = async handle => {\n    const {\n      data: { collectionData }\n    } = await this.props.refetchCollectionSeo({ handle });\n    console.log('COLLECTION loaded::', collectionData);\n    this.setState({ currentCategoryValues: collectionData.seo });\n  };\n  loadBrandSeo = async handle => {\n    const {\n      data: { vendorData }\n    } = await this.props.refetchBrandSeo({ handle });\n    console.log('Brand::', vendorData);\n    this.setState({ currentCategoryValues: vendorData.seo });\n  };\n  handleProductSelect = e =>\n    this.setState({\n      selectedProduct: e.target.value,\n      selectedSpec: selectSpecString,\n      currentEdit: {},\n      ...clearedSubmissionResult\n    });\n  handleCategorySelect = e => {\n    this.setState({ selectedCategory: e.target.value.toLowerCase() });\n  };\n  handleSpecSelect = e =>\n    this.setState({\n      selectedSpec: e.target.value,\n      ...clearedSubmissionResult\n    });\n\n  handleSpecInput = e => {\n    const { currentEdit: prevEdit } = this.state;\n    const {\n      target: { name, value }\n    } = e;\n    this.setState({ currentEdit: { ...prevEdit, [name]: value } });\n  };\n\n  submitSpecs = async e => {\n    e.preventDefault();\n\n    const {\n      productData,\n      addProductData,\n      updateProductData,\n      sfy_shop: { products }\n    } = this.props;\n    const { currentEdit, selectedProduct } = this.state;\n\n    const currentSpecs = productData === null ? {} : productData;\n    const { __typename, id, ...specsToSubmit } = Object.assign(currentSpecs, currentEdit, {\n      handle: selectedProduct\n    });\n\n    let dataUpdateResult;\n    if (productData === null) {\n      // If adding a new product data to rcomm db, add sku and product name from Shopify\n      const [sfyData] = products.edges.filter(({ node }) => node.handle === selectedProduct);\n      const {\n        title,\n        vendor,\n        variants: { edges: variantEdges }\n      } = sfyData.node;\n      const { sku: _sku } = variantEdges[0].node;\n      const updatedSubmission = { ...specsToSubmit, product_name: `${vendor} ${title}`, sku: _sku };\n      dataUpdateResult = await addProductData(updatedSubmission);\n    } else {\n      dataUpdateResult = await updateProductData(specsToSubmit);\n    }\n\n    if (!dataUpdateResult) return;\n\n    if ('errors' in dataUpdateResult) {\n      return this.setState({ submissionError: dataUpdateResult.errors[0] });\n    }\n\n    if ('productData' in dataUpdateResult && dataUpdateResult.productData) {\n      const { product_name, handle } = dataUpdateResult.productData;\n      this.props.refetchProductData({ handle });\n      return this.setState({\n        submissionSuccess: `Successfully updated ${product_name}!`,\n        currentEdit: {},\n        selectedSpec: selectSpecString\n      });\n    }\n  };\n\n  renderInputValue = () => {\n    const { selectedSpec, currentEdit } = this.state;\n    const { productData } = this.props;\n    if (selectedSpec in currentEdit) return currentEdit[selectedSpec];\n    else if (productData && selectedSpec in productData) return productData[selectedSpec];\n    else return '';\n  };\n\n  handleCancelEdit = () => {\n    const { currentEdit, selectedSpec } = this.state;\n    if (selectedSpec in currentEdit) {\n      const { [selectedSpec]: removed, ...rest } = currentEdit;\n      this.setState({ currentEdit: rest });\n    }\n    return;\n  };\n\n  isDisabled = () => {\n    const { loadingProductData, productData } = this.props;\n    if (!loadingProductData && !productData) return false;\n    if (Object.keys(this.state.currentEdit).length > 0) return false;\n    return true;\n  };\n  validateTitle = (values, errors) => {\n    if (!values.title) {\n      errors.title = 'Required';\n    } else if (values.title.length > 60) {\n      errors.title = 'The title length should be under 60 characters';\n    }\n    return { values, errors };\n  };\n  validateDescription = ({ values, errors }) => {\n    if (!values.description) {\n      errors.description = 'Required';\n    } else if (values.description.length > 320) {\n      errors.description = 'Content descriptions should be 320 characters or less';\n    }\n    return { values, errors };\n  };\n  validateKeyWords = ({ values, errors }) => {\n    if (!values.keywords) {\n      errors.keywords = 'Required';\n    }\n    return { values, errors };\n  };\n  validateAll = values => {\n    let errors = {};\n    const composeValidation = Rcompose(this.validateKeyWords, this.validateDescription, this.validateTitle);\n    const validation = composeValidation(values, errors);\n    return validation.errors;\n  };\n  handleBrandSelect = e => {\n    this.setState({ selectedBrand: e.target.value });\n  };\n  handleCollectionSelect = e => {\n    this.setState({ selectedCollection: e.target.value });\n  };\n  renderSelect = category => {\n    const { selectedProduct, selectedBrand, selectedCollection } = this.state;\n    const { vendors, collections } = this.props;\n    switch (category) {\n      case 'products': {\n        const products = this.props.sfy_shop.products.edges;\n        return products ? (\n          <div>\n            <label htmlFor=\"product-select\">Please select a product to change seo values</label>\n            <select id=\"product-select\" onChange={this.handleProductSelect} value={selectedProduct}>\n              <option value={selectProdString} disabled>\n                {selectProdString}\n              </option>\n              {products\n                ? products.map(({ node }) => (\n                    <option key={node.handle} value={node.handle}>\n                      {`${node.vendor}: ${node.title}`}\n                    </option>\n                  ))\n                : null}\n            </select>\n          </div>\n        ) : null;\n      }\n      case 'brands': {\n        return (\n          <div>\n            <label htmlFor=\"product-select\">Please select a brand to change seo values</label>\n            <select id=\"product-select\" onChange={this.handleBrandSelect} value={selectedBrand}>\n              <option value={selectBrandString} disabled>\n                {selectBrandString}\n              </option>\n              {vendors\n                ? vendors.map(({ handle, name }) => (\n                    <option key={handle} value={handle}>\n                      {`${name}`}\n                    </option>\n                  ))\n                : null}\n            </select>\n          </div>\n        );\n      }\n      case 'collections': {\n        return (\n          <div>\n            <label htmlFor=\"product-select\">Please select a collection to change seo values</label>\n            <select id=\"product-select\" onChange={this.handleCollectionSelect} value={selectedCollection}>\n              <option value={selectCollectionString} disabled>\n                {selectCollectionString}\n              </option>\n              {collections\n                ? collections.map(({ node }) => (\n                    <option key={node.handle} value={node.handle}>\n                      {`${node.title}`}\n                    </option>\n                  ))\n                : null}\n            </select>\n          </div>\n        );\n      }\n      default:\n        return null;\n    }\n  };\n  currentSeoData = () => {\n    return this.state.currentCategoryValues;\n  };\n  render() {\n    const {\n      selectedProduct,\n      selectedBrand,\n      selectedCollection,\n      selectedCategory,\n      categories,\n      currentCategoryValues\n    } = this.state;\n    const { productsLoading, sfy_shop } = this.props;\n    // console.log('THE PROPS::', this.props);\n    let products = null;\n    // let seo = null;\n    if (!productsLoading && sfy_shop && 'products' in sfy_shop) {\n      if (sfy_shop.products.edges.length > 0) {\n        products = sfy_shop.products.edges;\n      }\n    }\n    // if (productData) {\n    //   seo = productData.seo;\n    // }\n    if (!products) {\n      return <Loader />;\n    }\n\n    return (\n      <section className=\"manage-specs\">\n        <div className=\"form__select-group\">\n          <label htmlFor=\"product-select\">Please select content category to update</label>\n          <select id=\"product-select\" onChange={this.handleCategorySelect} value={selectedCategory}>\n            <option value={selectedCategory} disabled>\n              {selectedCategory}\n            </option>\n            {categories.map(category => (\n              <option key={category} value={category}>\n                {category}\n              </option>\n            ))}\n          </select>\n        </div>\n        {this.renderSelect(selectedCategory)}\n\n        <SeoForm\n          seo={this.currentSeoData()}\n          validateAll={this.validateAll}\n          uploadSeoContent={this.props.uploadSeoContent}\n          uploadSeo={this.props.uploadSeo}\n          selectedProduct={selectedProduct}\n          selectedBrand={selectedBrand}\n          selectedCollection={selectedCollection}\n          selectedCategory={selectedCategory}\n          valuesAvailable={currentCategoryValues}\n        />\n      </section>\n    );\n  }\n}\n\nconst ManageSeoWithApollo = compose(\n  withApollo,\n  ADMIN_PRODUCTS_QUERY(),\n  graphql(VENDOR_SEO_QUERY, {\n    options: () => ({ variables: { handle: '' } }),\n    props: ({ data }) => {\n      // console.log('VENDOR SEO Data::', data);\n      const { loading, error, refetch } = data;\n      if (error) {\n        return { brandSeoError: error };\n      }\n      if (!loading) {\n        return { refetchBrandSeo: refetch };\n      }\n    }\n  }),\n  graphql(COLLECTION_SEO_QUERY, {\n    options: () => ({ variables: { handle: '' } }),\n    props: ({ data }) => {\n      // console.log('COLLECITON SEO DATA::', data);\n      const { loading, error, refetch } = data;\n\n      if (error) {\n        return { collectionSeoError: error };\n      }\n      if (!loading) {\n        return { loadingCollectionSeo: loading, refetchCollectionSeo: refetch };\n      }\n    }\n  }),\n  graphql(COLLECTIONS_QUERY, {\n    options: () => ({ variables: { first: 100 } }),\n    props: ({ data }) => {\n      // console.log('COLLECTIONS QUERY DATA::', data);\n      const { loading, admin_collections } = data;\n      if (!loading) {\n        const { edges } = admin_collections;\n        return { loadingCollections: loading, collections: edges };\n      }\n    }\n  }),\n  graphql(PRODUCT_SEO_QUERY, {\n    options: () => ({ variables: { handle: '' }, fetchPolicy: 'network-only' }),\n    props: ({ data }) => {\n      // console.log('PRODUCTS SEO DATA', data);\n      const { loading: loadingProductData, error, productData, refetch: refetchProductData } = data;\n      if (error) throw new Error(`Error in Related Prodcuts Query: ${error}`);\n      return { loadingProductData, productData, refetchProductData };\n    }\n  }),\n  graphql(UPLOAD_SEO, {\n    props: ({ mutate }) => ({\n      uploadSeo: async seoData => {\n        const { data } = await mutate({ variables: seoData });\n        return data.uploadSeo;\n      }\n    })\n  }),\n  graphql(UPLOAD_SEO_CONTENT, {\n    props: ({ mutate }) => ({\n      uploadSeoContent: async seoData => {\n        console.log('UPLOAD SEO DATA:', seoData);\n        const {\n          data: { updateProductSeo }\n        } = await mutate({ variables: { seo: seoData } });\n        console.log('CONTENT:', updateProductSeo);\n        return updateProductSeo;\n      }\n    })\n  }),\n  graphql(VENDORS_QUERY, {\n    props: ({ data: { loading, error, vendors } }) => {\n      if (error) throw new Error(`Error in Vendors Query: ${error}`);\n      return { loading, vendors };\n    }\n  }),\n  MODIFY_PRODUCT_DATA(ADD_PRODUCT_DATA, 'addProductData'),\n  MODIFY_PRODUCT_DATA(UPDATE_PRODUCT_DATA, 'updateProductData')\n)(ManageSeo);\n\nManageSeo.propTypes = {\n  uploadSeo: PropTypes.func,\n  refetchBrandSeo: PropTypes.func,\n  refetchCollectionSeo: PropTypes.func,\n  vendors: PropTypes.array,\n  collections: PropTypes.array,\n  productsLoading: PropTypes.bool,\n  products: PropTypes.array,\n  productSpecs: PropTypes.array,\n  refetchProductData: PropTypes.func,\n  sfy_shop: PropTypes.object,\n  productData: PropTypes.object,\n  loadingProductData: PropTypes.bool,\n  uploadSeoContent: PropTypes.func\n};\n\nexport default ManageSeoWithApollo;\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAXA;AAmCA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAEA;AACA;AACA;AACA;AACA;AANA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;;;;AAMA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAEA;AACA;AACA;AACA;AACA;AANA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;;;;AAMA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAEA;AACA;AACA;AACA;AACA;AANA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;;;;AAMA;AAAA;AAEA;AACA;AACA;AAHA;AADA;AAQA;AACA;AACA;AAEA;AADA;AADA;AAMA;AAAA;AAAA;AAAA;AACA;AAIA;AACA;AAEA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AACA;AAFA;AAAA;AAWA;AAXA;AAaA;AADA;AAIA;AACA;AAjBA;AAAA;AAAA;AAAA;AACA;AAiBA;AAlBA;AAmBA;AAAA;AAAA;AAnBA;AAyBA;AACA;AA1BA;AAAA;AACA;AADA;AA2BA;AA3BA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AA6BA;AACA;AA9BA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AACA;AAuCA;AAxCA;AA0CA;AACA;AACA;AAHA;AACA;AA1CA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;;;;AAgDA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AAGA;AAEA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AADA;AAGA;AACA;AAAA;AACA;AAAA;AACA;AADA;AADA;AALA;AAFA;AAgBA;AACA;AAAA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AADA;AAGA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AADA;AALA;AAFA;AAgBA;AACA;AAAA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AADA;AAGA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AADA;AALA;AAFA;AAgBA;AACA;AACA;AA5DA;AA8DA;AAEA;AACA;;;;;AAhPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AA6NA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAUA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AADA;AAGA;AAAA;AACA;AAAA;AACA;AADA;AADA;AAJA;AAFA;AAaA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AATA;AAhBA;AA6BA;;;;AAvTA;AACA;AAyTA;AAIA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AADA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAXA;AAcA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AADA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAZA;AAeA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AADA;AAAA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AATA;AAYA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AADA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AAPA;AAUA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AACA;AADA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AADA;AAAA;AADA;AASA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AACA;AADA;AAAA;AAGA;AACA;AACA;AALA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AADA;AAAA;AADA;AAaA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AAJA;AACA;AASA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAbA;AACA;AAeA;;;;A","sourceRoot":""}