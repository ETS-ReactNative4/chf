{"version":3,"file":"index.d2b89da00307596b2e54.hot-update.js","sources":["src/app.js"],"sourcesContent":["import express from 'express';\nimport path from 'path';\nimport Sitemap from 'react-router-sitemap';\nimport { isApiExternal } from './net';\nimport modules from './modules';\nimport websiteMiddleware from './middleware/website';\nimport graphiqlMiddleware from './middleware/graphiql';\nimport createGraphServer from './graphql';\nimport errorMiddleware from './middleware/error';\nimport { createStich } from './api/remoteSchema';\nimport Routes from '../../client/src/app/Routes';\n\nconst router = Routes;\n\nconst createExpressApp = async () => {\n  console.log('HELLOOOOOO', process.cwd);\n  new Sitemap(router).build('https://cahomefitness.com').save('./sitemapTEST.xml', '/public/');\n  const app = express();\n\n  for (const applyBeforeware of modules.beforewares) {\n    applyBeforeware(app);\n  }\n  // console.log('TEST::::');\n  // Don't rate limit heroku\n  app.enable('trust proxy');\n\n  const corsOptions = {\n    credentials: true,\n    origin: true\n  };\n\n  for (const applyMiddleware of modules.middlewares) {\n    applyMiddleware(app);\n  }\n\n  if (__DEV__) {\n    app.get('/servdir', (req, res) => {\n      res.send(process.cwd() + path.sep);\n    });\n  }\n\n  if (!isApiExternal) {\n    const graphqlServer = await createGraphServer();\n    graphqlServer.applyMiddleware({\n      app,\n      path: __API_URL__,\n      cors: corsOptions\n    });\n  }\n  await createStich;\n  app.get('/graphiql', (...args) => graphiqlMiddleware(args[0])(...args));\n\n  // For monitoring status\n  app.get('/status', (req, res) => res.status(200).send());\n  app.use((...args) => websiteMiddleware(...args));\n  app.use(express.static('public'));\n\n  app.use(\n    '/',\n    express.static(__FRONTEND_BUILD_DIR__, {\n      maxAge: '180 days'\n    })\n  );\n\n  if (__DEV__) {\n    app.use('/', express.static(__DLL_BUILD_DIR__, { maxAge: '180 days' }));\n    app.use(errorMiddleware);\n  }\n\n  if (module.hot) {\n    module.hot.accept(['./middleware/website', './graphql']);\n  }\n\n  return app;\n};\n\nexport default createExpressApp;\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAHA;AAAA;AAAA;AAAA;AACA;AACA;AAGA;AAAA;AACA;AAAA;AACA;AACA;AACA;AATA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AADA;AACA;AADA;AAAA;AACA;AADA;AAAA;AACA;AADA;AAUA;AACA;AACA;AACA;AACA;AAFA;AAZA;AAAA;AAAA;AAAA;AACA;AACA;AAeA;AAAA;AACA;AAAA;AACA;AACA;AApBA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AADA;AACA;AADA;AAAA;AACA;AADA;AAAA;AACA;AADA;AAqBA;AACA;AACA;AACA;AACA;AACA;AA1BA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AACA;AADA;AA4BA;AACA;AAAA;AACA;AACA;AACA;AAHA;AACA;AA9BA;AAAA;AAAA;AACA;AADA;AAoCA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AACA;AAGA;AADA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AA1DA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AA6DA;;;;A","sourceRoot":""}