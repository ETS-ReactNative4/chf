{"version":3,"file":"index.88f8708a9ceb94f8117a.hot-update.js","sources":["/Users/austinreynolds/Documents/MOD/chf-rcomm/packages/client/src/modules/admin/containers/Products.jsx"],"sourcesContent":["import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport { compose, graphql, withApollo } from 'react-apollo';\nimport gql from 'graphql-tag';\nimport { MdSearch } from 'react-icons/md';\n\nimport AdminView from '../components/AdminView';\nimport Loader from '../../common/components/global/components/Loader';\nimport '../styles/productspecs.scss';\nimport ProductSpecs from '../components/ProductSpecs';\n// import { ADMIN_PRODUCTS_QUERY /*MODIFY_PRODUCT_DATA*/ } from '../../common/schema';\nimport PRODUCTS_QUERY from '../graphql/Products.graphql';\n\nconst columns = [\n  {\n    title: '',\n    dataIndex: 'node',\n    key: 'featuredImage',\n    // eslint-disable-next-line\n    render: (image, record) => {\n      return (\n        <div>\n          <img src={image ? image.originalSrc : ''} alt=\"\" />\n          {/* <Link to={{ pathname: `/admin/locations/${record.node.handle}` }}>{text}</Link> */}\n        </div>\n      );\n    }\n  },\n  {\n    title: (\n      <a href=\"#\">\n        <h3>Product</h3>\n      </a>\n    ),\n    dataIndex: 'node',\n    key: 'title',\n    // eslint-disable-next-line\n    render: (text, record) => {\n      return (\n        <div>\n          {text}\n          {/* <Link to={{ pathname: `/admin/locations/${record.node.handle}` }}>{text}</Link> */}\n        </div>\n      );\n    }\n  },\n  {\n    title: (\n      <a href=\"#\">\n        <h3>Vendor</h3>\n      </a>\n    ),\n    dataIndex: 'node',\n    key: 'vendor',\n    // eslint-disable-next-line\n    render: (text, record) => {\n      return (\n        <div>\n          {text}\n          {/* <Link to={{ pathname: `/admin/locations/${record.node.handle}` }}>{text}</Link> */}\n        </div>\n      );\n    }\n  }\n];\nconst LoadMore = ({ loadMore }) => {\n  return (\n    <div className=\"admin__loadmore\">\n      <button onClick={() => loadMore()}>Load More</button>\n    </div>\n  );\n};\nLoadMore.propTypes = {\n  loadMore: PropTypes.func\n};\nconst SearchBar = ({ handleSearch, value }) => {\n  return (\n    <div className=\"admin__searchbox\">\n      <span>\n        <MdSearch size={20} />\n      </span>\n      <input type=\"text\" placeholder=\"Search\" onChange={handleSearch} value={value} />\n    </div>\n  );\n};\nSearchBar.propTypes = {\n  handleSearch: PropTypes.func,\n  value: PropTypes.string\n};\nclass Products extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      searchActive: false,\n      searchValue: '',\n      filteredProducts: null\n    };\n  }\n  componentDidUpdate(prevProps, prevState) {\n    const prevSearch = prevState.searchValue;\n    const currSearch = this.state.searchValue;\n    if (currSearch.length > 0 && currSearch !== prevSearch) {\n      this.setState({ searchActive: true });\n      this.searchQuery();\n      return;\n    }\n    if (currSearch !== prevSearch && currSearch.length == 0) {\n      return this.setState({ searchActive: false, filteredProducts: null });\n    }\n  }\n  searchQuery = async () => {\n    const { searchValue } = this.state;\n    const query = gql`\n      query admin_products($first: Int, $after: String, $query: String) {\n        admin_products(first: $first, after: $after, query: $query) {\n          edges {\n            cursor\n            node {\n              vendor\n              title\n              featuredImage {\n                originalSrc\n              }\n            }\n          }\n        }\n      }\n    `;\n    const { data } = await this.props.client.query({\n      query,\n      fetchPolicy: 'cache-first',\n      variables: { first: 20, query: `title:${searchValue}*` }\n    });\n    const { admin_products } = data;\n    this.setState({ filteredProducts: admin_products });\n  };\n  handleSearch = e => {\n    this.setState({ searchValue: e.target.value });\n  };\n  render() {\n    const { productsLoading, admin_products } = this.props;\n    const { searchActive, searchValue, filteredProducts } = this.state;\n    if (productsLoading) {\n      return (\n        <AdminView {...this.props}>\n          <Loader />\n        </AdminView>\n      );\n    }\n    return (\n      <AdminView {...this.props}>\n        <h2>Product Specifications</h2>\n        <div className=\"admin__tableview\">\n          <div className=\"admin__productspecs\">\n            <SearchBar handleSearch={this.handleSearch} value={searchValue} />\n            {searchActive && filteredProducts ? (\n              <ProductSpecs dataSource={filteredProducts.edges} columns={columns} />\n            ) : (\n              <ProductSpecs dataSource={admin_products.edges} columns={columns} />\n            )}\n          </div>\n          <LoadMore loadMore={this.props.loadMore} />\n        </div>\n      </AdminView>\n    );\n  }\n}\nconst ProductsApollo = compose(\n  withApollo,\n  graphql(PRODUCTS_QUERY, {\n    options: () => ({\n      variables: { first: 50 }\n    }),\n    props: ({ data }) => {\n      console.log('DATA;::', data);\n      const { loading, error, admin_products, variables, fetchMore } = data;\n      if (error) {\n        throw new Error(error);\n      }\n      if (loading) {\n        return { productsLoading: loading };\n      }\n      if (!loading && admin_products) {\n        let currEndCursor;\n        let hasNextPage;\n        let hasPreviousPage;\n        const { edges } = admin_products;\n        if (edges.length > 0) {\n          currEndCursor = edges[edges.length - 1].cursor;\n        }\n        hasNextPage = admin_products.pageInfo.hasNextPage;\n        hasPreviousPage = admin_products.pageInfo.hasPreviousPage;\n        console.log('Curr end cursor::', currEndCursor);\n        const loadMore = (first = 50, after = currEndCursor) => {\n          const updatedVars = { ...variables, after, first };\n          console.log('UPDATED VARS::', updatedVars);\n          return fetchMore({\n            variables: updatedVars,\n            updateQuery: (prevResult, { fetchMoreResult }) => {\n              console.log('PREVRESULT:', prevResult);\n              if (fetchMoreResult.admin_products.edges.length === 0) return prevResult;\n              const updatedResult = JSON.parse(JSON.stringify(prevResult));\n              console.log('PREV RESULT STRING', updatedResult);\n              // const updatedResult = Object.assign({}, prevResult);\n              updatedResult.admin_products.edges = [\n                ...prevResult.admin_products.edges,\n                ...fetchMoreResult.admin_products.edges\n              ];\n              //\n              updatedResult.pageInfo = fetchMoreResult.admin_products.pageInfo;\n              // updatedResult.admin_products.pageInfo = fetchMoreResult.admin_products.pageInfo;\n              // console.log('udpatedres', updatedResult);\n              // const update = Object.assign({}, prevResult, {\n              //   admin_products: {\n              //     edges: [...prevResult.admin_products.edges, ...fetchMoreResult.admin_products.edges],\n              //     pageInfo: fetchMoreResult.admin_products.pageInfo\n              //     // __typename: prevResult.admin_products.__typename\n              //   },\n              //   __typename: prevResult.admin_products.__typename\n              // });\n              console.log('UPDATE::', updatedResult);\n              return updatedResult;\n            }\n          });\n        };\n        return {\n          productsLoading: loading,\n          admin_products,\n          loadMore,\n          products: {\n            currEndCursor,\n            hasNextPage,\n            hasPreviousPage\n          }\n        };\n      }\n    }\n  })\n)(Products);\n\nexport default ProductsApollo;\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AADA;AAKA;AAZA;AAeA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AADA;AAIA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AADA;AAKA;AAhBA;AAmBA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AADA;AAIA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AADA;AAKA;AAhBA;AAmBA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AADA;AAIA;AACA;AACA;AADA;AAGA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AADA;AAGA;AAJA;AAOA;AACA;AACA;AACA;AAFA;AACA;AAGA;;;AACA;AAAA;AACA;AADA;AACA;AADA;AACA;AADA;AAoBA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AACA;AAFA;AAAA;AAmBA;AACA;AACA;AAHA;AACA;AAnBA;AAAA;AAkBA;AAKA;AACA;AAAA;AACA;AAzBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AArBA;AA+CA;AACA;AACA;AA/CA;AACA;AACA;AACA;AAHA;AAFA;AAOA;AACA;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AA8BA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AAAA;AACA;AADA;AAIA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AAFA;AAQA;AATA;AAFA;AAeA;;;;AA5EA;AACA;AA6EA;AAGA;AAAA;AACA;AADA;AAAA;AAGA;AAAA;AACA;AAAA;AADA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAHA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA1BA;AA4BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAHA;AAJA;AAUA;AACA;AAnEA;AACA;AAsEA;;;;A","sourceRoot":""}