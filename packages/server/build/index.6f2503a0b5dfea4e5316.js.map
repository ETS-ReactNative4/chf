{"version":3,"file":"index.10df989b4479fa2471ff.hot-update.js","sources":["/Users/austinreynolds/Documents/MOD/chf-rcomm/packages/client/src/modules/products/containers/SingleProduct.jsx"],"sourcesContent":["/* eslint-disable no-undef */\nimport React from 'react';\nimport { graphql, compose, withApollo } from 'react-apollo';\nimport PropTypes from 'prop-types';\nimport { connect } from 'react-redux';\nimport SingleProductView from '../components/SingleProductView';\n//import { filter } from './Category';\n//import SINGLE_PRODUCT_QUERY from '../../common/graphql/SFY/sfySingleProduct.graphql';\nimport SINGLE_PRODUCT_QUERY from '../../common/graphql/SFY/sfySingleProductByHandle.graphql';\nimport CREATE_CART from '../../common/graphql/SFY/sfyCheckoutCreate.graphql';\nimport ADD_CART_ITEM from '../../common/graphql/SFY/sfyCheckoutLineItemsAdd.graphql';\nimport VENDORS_QUERY from '../../common/graphql/VendorsQuery.graphql';\nimport RELATED_PRODUCTS_QUERY from '../../common/graphql/RelatedProductsQuery.graphql';\nimport PRODUCT_DATA_QUERY from '../../common/graphql/ProductDataQuery.graphql';\n\n//TODO: Add to common file\nconst toggleCart = () => ({ type: 'TOGGLE_CART' });\nconst updateQty = cartQty => {\n  return { type: 'UPDATE_CART_QTY', cartQty };\n};\nconst cartQty = lineItemEdges => {\n  if (lineItemEdges.length === 0) return 0;\n  return lineItemEdges.reduce((acc, { node: { quantity: qty } }) => {\n    return acc + qty;\n  }, 0);\n};\n\nclass ProductView extends React.Component {\n  render() {\n    return <SingleProductView {...this.props} />;\n  }\n}\n\nconst ProductViewWithApollo = compose(\n  withApollo,\n  graphql(SINGLE_PRODUCT_QUERY, {\n    options: props => {\n      console.log('PROPS::', props);\n      const { state: handle } = props.location;\n      console.log('HANDLE:', handle);\n      return { variables: { handle } };\n    },\n    props: ({ data }) => {\n      // console.log('DATA::::', data);\n      const { loading, sfy_shop, error } = data;\n      if (error) throw new Error(`Error in Products Query: ${error}`);\n      else if (loading || !sfy_shop) return { loading };\n      else if (!loading && sfy_shop) return { loading, product: sfy_shop.productByHandle };\n    }\n  }),\n  graphql(CREATE_CART, {\n    props: ({ ownProps: { updateCartQty }, mutate }) => ({\n      createInitialCheckout: async addedItem => {\n        try {\n          const {\n            data: {\n              sfy_checkoutCreate: { checkout, checkoutUserErrors: userErrors }\n            }\n          } = await mutate({\n            variables: { input: addedItem }\n          });\n          if (Array.isArray(userErrors) && userErrors.length > 0) {\n            return { errors: userErrors.map(err => err.message) };\n          } else {\n            if ('id' in checkout && checkout.id && typeof window !== 'undefined') {\n              updateCartQty(cartQty(checkout.lineItems.edges));\n              localStorage.setItem('sfy-checkout-id', checkout.id);\n              return checkout;\n            }\n          }\n        } catch (e) {\n          console.log(e.graphQLErrors);\n        }\n      }\n    })\n  }),\n  graphql(ADD_CART_ITEM, {\n    props: ({ ownProps: { updateCartQty }, mutate }) => ({\n      addCartItem: async addedItem => {\n        try {\n          const {\n            data: {\n              sfy_checkoutLineItemsAdd: { checkout, checkoutUserErrors: userErrors }\n            }\n          } = await mutate({\n            variables: addedItem\n          });\n          if (Array.isArray(userErrors) && userErrors.length > 0) {\n            return { errors: userErrors.map(err => err.message) };\n          } else {\n            if ('id' in checkout && checkout.id && typeof window !== 'undefined') {\n              updateCartQty(cartQty(checkout.lineItems.edges));\n              localStorage.setItem('sfy-checkout-id', checkout.id);\n              return checkout;\n            }\n          }\n        } catch (e) {\n          console.log(e.graphQLErrors);\n        }\n      }\n    })\n  }),\n  graphql(VENDORS_QUERY, {\n    props: ({ data: { loading, error, vendors } }) => {\n      if (error) throw new Error(`Error in Vendors Query: ${error}`);\n      return { loading, vendors };\n    }\n  }),\n  graphql(PRODUCT_DATA_QUERY, {\n    options: props => {\n      const { state: handle } = props.location;\n      return { variables: { handle } };\n    },\n    props: ({ data }) => {\n      const { loading, error, productData } = data;\n      console.log('product data::::', productData);\n      if (error) throw new Error(`Error in Product Data Query: ${error}`);\n      return { loading, productData };\n    }\n  }),\n  graphql(RELATED_PRODUCTS_QUERY, {\n    options: props => {\n      const { state: product_handle } = props.location;\n      return { variables: { product_handle } };\n    },\n    props: ({ data }) => {\n      // console.log('REL PROD DATA', data);\n      const { loading, error, relatedProducts } = data;\n      if (error) throw new Error(`Error in Related Prodcuts Query: ${error}`);\n      return { loading, relatedProducts };\n    }\n  })\n)(ProductView);\n\nconst ProductViewWithRedux = connect(\n  null,\n  dispatch => ({\n    toggleCart: () => dispatch(toggleCart()),\n    updateCartQty: cartQty => dispatch(updateQty(cartQty))\n  })\n)(ProductViewWithApollo);\n\nProductView.propTypes = {\n  location: PropTypes.object\n};\n\nexport default ProductViewWithRedux;\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;;;AACA;AACA;AACA;;;;AAHA;AACA;AAKA;AAGA;AACA;AADA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AAAA;AADA;AAAA;AAAA;AACA;AAEA;AAGA;AAbA;AAgBA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAOA;AADA;AACA;AAPA;AAAA;AAAA;AAIA;AAAA;AACA;AALA;AAAA;AAAA;AAAA;AACA;AADA;AAUA;AAAA;AACA;AAXA;AAAA;AAAA;AAAA;AAAA;AACA;AAYA;AACA;AAdA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AAkBA;AACA;AApBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AADA;AAAA;AADA;AA2BA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAOA;AADA;AACA;AAPA;AAAA;AAAA;AAIA;AAAA;AACA;AALA;AAAA;AAAA;AAAA;AACA;AADA;AAUA;AAAA;AACA;AAXA;AAAA;AAAA;AAAA;AAAA;AACA;AAYA;AACA;AAdA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AAkBA;AACA;AApBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AADA;AAAA;AADA;AA2BA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AAJA;AAOA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAVA;AAaA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AADA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AAVA;AACA;AAaA;AAEA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAFA;AAAA;AACA;AAKA;AACA;AADA;AACA;AAGA;;;;A","sourceRoot":""}