{"version":3,"file":"index.cbee85f395fc0c5011da.hot-update.js","sources":["/Users/austinreynolds/Documents/MOD/chf-rcomm/packages/client/src/modules/admin/containers/Location.jsx"],"sourcesContent":["import React from 'react';\nimport { graphql, compose, withApollo } from 'react-apollo';\nimport axios from 'axios';\nimport { forEach, values, pick } from 'ramda';\n\nimport DEALERS_QUERY from '../graphql/Dealers.graphql';\nimport DEALER_BY_HANDLE_QUERY from '../graphql/DealerQuery.graphql';\nimport UPDATE_DEALER from '../graphql/UpdateDealer.graphql';\nimport S3SIGNUPLOAD from '../graphql/S3Upload.graphql';\nimport '../styles/locations.scss';\nimport LocationInfo from '../components/Locations/LocationInfo';\nimport SuccessModal from '../components/Modal';\n\n/*eslint-disable no-unused-vars*/\n\nimport AdminView from '../components/AdminView';\nimport ImagePreview from '../components/CarouselImages/ImagePreview';\nimport AWSImageAdapter from '../components/CarouselImages/ImageAdapter';\n\nconst uploadToS3 = () => {\n  return;\n};\n\nclass Location extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      image: null,\n      percentCompleted: 0,\n      modalState: false\n    };\n  }\n  componentDidMount() {\n    // console.log('MOUNT PROPS ON LOCATION:', this.props);\n  }\n  componentDidUpdate(prevProps, prevState) {\n    // console.log('C D U:::', this.props.dealerByHandle);\n    if (this.props.dealerByHandle) {\n      if (!prevState.image) {\n        this.setState({ image: this.props.dealerByHandle.image_url });\n      }\n    }\n    const { percentCompleted } = this.state;\n    // console.log('PERCENT COMPLETED::', percentCompleted);\n    if (percentCompleted > 0) {\n      this.updateProgress(percentCompleted);\n    }\n    if (percentCompleted == 0 || percentCompleted == 100) {\n      const elem = document.getElementById('upload-bar');\n      elem.style.visibility = 'hidden';\n      return;\n    }\n  }\n  updateProgress = percent => {\n    const elem = document.getElementById('upload-bar');\n    elem.style.visibility = 'visible';\n    elem.style.width = percent + '%';\n    elem.innerHTML = percent * 1 + '%';\n  };\n  uploadToS3 = async (signedRequest, file) => {\n    const options = {\n      headers: {\n        'Content-Type': `\"${file.type}\"`\n      },\n      onUploadProgress: function(progressEvent) {\n        // console.log('');\n        let percentCompleted = Math.round((progressEvent.loaded * 100) / progressEvent.total);\n        // console.log('UPLOAD PROGRESS:::', percentCompleted);\n        this.setState({ percentCompleted });\n      }.bind(this)\n    };\n    await axios.put(signedRequest, file, options);\n  };\n  adaptFileEventToValue = delegate => async e => {\n    const {\n      target: { files }\n    } = e;\n    // console.log('FILES;::', files);\n    const { signS3 } = this.props;\n    // const image_data = new Map();\n    const getFileNameAndType = file => pick(['name', 'type'], file);\n    const response = async (signS3, { name, type }) => await signS3(name, type);\n\n    if (files.length !== 0 && typeof files !== 'undefined') {\n      let updatedImageData;\n      // TODO THIS FOREACH BIZ SUCKS WE ARE HAVING TO SET STATE WAY TO MUCH IN THIS LOOP\n      // BUT PLACING SETSTATE AFTER FOREACH FIRES BEFORE UPDATED IMAGEMAP IS CREATED\n      forEach(async file => {\n        // NOTE JUST need to update the state and then map the urls down on the preview component\n        const { name } = getFileNameAndType(file);\n        const res = await response(signS3, getFileNameAndType(file));\n        const { signedRequest, url } = res.data.signS3;\n        await this.uploadToS3(signedRequest, file);\n        this.setState({ image: url });\n        delegate('image_url', url);\n      }, values(files));\n    }\n  };\n  showModal = () => {\n    // console.log('SHOW MODAL');\n    this.setState({ modalState: !this.state.modalState });\n  };\n  closeModal = () => {\n    this.setState({ modalState: !this.state.modalState });\n  };\n  render() {\n    // console.log('The props::::', this.props);\n    // console.log('The state::', this.state);\n    const { image } = this.state;\n    return (\n      <AdminView {...this.props}>\n        <LocationInfo\n          showModal={this.showModal}\n          image={this.state.image}\n          adaptFileEventToValue={this.adaptFileEventToValue}\n          {...this.props}\n        >\n          {this.state.modalState ? <SuccessModal showModal={this.state.modalState} onClick={this.closeModal} /> : null}\n        </LocationInfo>\n      </AdminView>\n    );\n  }\n}\nconst LocationWithApollo = compose(\n  withApollo,\n  graphql(DEALER_BY_HANDLE_QUERY, {\n    options: props => {\n      const handle = props.match.params.location_handle;\n      return { variables: { handle } };\n    },\n    props: ({ data }) => {\n      return { ...data };\n    }\n  }),\n  graphql(DEALERS_QUERY, {\n    options: () => ({\n      variables: { first: 12, after: 0 }\n    }),\n    props: ({ data }) => {\n      const { loading, error, dealers } = data;\n      if (error) {\n        return { dealersError: error };\n      }\n      if (loading) {\n        return { loadingDealers: loading };\n      }\n      if (!loading && !error) {\n        return { loadingDealers: loading, dealers };\n      }\n    }\n  }),\n  graphql(UPDATE_DEALER, {\n    props: ({ mutate }) => ({\n      updateDealer: async dealer => {\n        try {\n          const {\n            data: { updateDealer }\n          } = await mutate({\n            variables: { dealer }\n          });\n          return updateDealer;\n        } catch (e) {\n          console.log('ERROR UPDATING:', e);\n        }\n      }\n    })\n  }),\n  graphql(S3SIGNUPLOAD, {\n    props: ({ mutate }) => ({\n      signS3: async (filename, filetype) => {\n        let response = await mutate({\n          variables: {\n            filename,\n            filetype\n          }\n        });\n        return response;\n      }\n    })\n  })\n)(Location);\n\nexport default LocationWithApollo;\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA;AAAA;AACA;AADA;AACA;AADA;AACA;AADA;AA8BA;AACA;AACA;AACA;AACA;AACA;AAnCA;AAAA;AAmCA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AADA;AAGA;AACA;AACA;AACA;AACA;AACA;AATA;AADA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AApCA;AAAA;AAAA;AAAA;AACA;AADA;AAiDA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAEA;AACA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AARA;AAQA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AATA;AAAA;AAAA;AAAA;AACA;AASA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAGA;AAHA;AAAA;AAAA;AACA;AADA;AAMA;AACA;AACA;AARA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AASA;AACA;AAxBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AACA;AAlDA;AA2EA;AACA;AACA;AACA;AA9EA;AA+EA;AACA;AACA;AA/EA;AACA;AACA;AACA;AAHA;AAFA;AAOA;AACA;;;AAAA;AACA;AACA;;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AANA;AAQA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAqDA;AACA;AACA;AAFA;AACA;AAGA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AACA;AAHA;AAMA;AANA;AADA;AAWA;;;;AAlGA;AACA;AAmGA;AAGA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AAPA;AAUA;AAAA;AACA;AADA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAfA;AAkBA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAKA;AADA;AACA;AALA;AAAA;AAGA;AAHA;AACA;AADA;AAAA;AAAA;AACA;AAQA;AACA;AAVA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AADA;AAAA;AADA;AAiBA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AAFA;AADA;AACA;AAFA;AACA;AADA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AADA;AAAA;AADA;AACA;AAcA;;;;A","sourceRoot":""}