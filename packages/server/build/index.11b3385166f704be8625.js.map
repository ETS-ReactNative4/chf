{"version":3,"file":"index.b2bba56683530b3ad99b.hot-update.js","sources":["src/modules/dealers/sql.js"],"sourcesContent":["/*eslint-disable no-unused-vars*/\nimport knex from '../../sql/connector';\n\nexport default class Dealers {\n  static alterDealers = async () => {\n    try {\n      const done = await knex.schema.alterTable('dealers', t => {\n        t.string('image_url');\n        t.text('description');\n        t.string('url_name');\n        t.string('hours');\n        t.string('handle');\n      });\n      if (done) {\n        return true;\n      }\n    } catch (e) {\n      throw new Error(e);\n    }\n  };\n  get = {\n    async dealers() {\n      try {\n        const dealers = await knex('dealers').select('*').orderBy('name');\n        const isUpdated = await knex.schema.hasColumn('dealers', 'image_url');\n\n        if (!isUpdated) {\n          const updated = await Dealers.alterDealers();\n          if (updated) {\n            return { isUpdated: true };\n          }\n        }\n        return dealers;\n      } catch (e) {\n        return e;\n      }\n    },\n    async dealerByHandle({ handle }) {\n      console.log('DEALER HANDLE IN SQL::', handle);\n      try {\n        const dealer = await knex('dealers')\n          .where({ handle })\n          .select('*')\n          .first();\n        return dealer;\n      } catch (e) {\n        console.log('Dealer by handle error', e);\n        return e;\n      }\n    }\n  };\n  insertOrUpdate = {\n    async updateDealer(input) {\n      console.log('INSERT HANDLE:', input.handle);\n      try {\n        const update = await knex('dealers').where({ handle: input.handle });\n        if (update.length == 0) {\n          console.log('HANDLE::', input.handle);\n          await knex('dealers').insert({ ...input });\n          return knex('dealers')\n            .select('*')\n            .where({ handle: input.handle })\n            .first();\n        } else {\n          await knex('dealers')\n            .where({ handle: input.handle })\n            .update({ ...input });\n\n          return knex('dealers')\n            .where({ handle: input.handle })\n            .select('*')\n            .first();\n        }\n      } catch (e) {\n        return e;\n      }\n    }\n  };\n  update = {};\n  delete = {};\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;;;AAiBA;AACA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAEA;AAFA;AAAA;AACA;AADA;AAGA;AACA;AAJA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AACA;AADA;AAMA;AACA;AAPA;AAAA;AAAA;AAAA;AACA;AADA;AACA;AADA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAeA;AACA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAGA;AAHA;AACA;AADA;AAAA;AAAA;AACA;AAQA;AATA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAYA;AA7BA;AA+BA;AACA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAGA;AACA;AAJA;AAAA;AAAA;AAAA;AACA;AAIA;AALA;AAAA;AACA;AADA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAwBA;AAzBA;AA2BA;AACA;AA3EA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AATA;AAEA;AACA;AAHA;AAAA;AAAA;AAAA;AACA;AADA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;A","sourceRoot":""}