{"version":3,"file":"index.01d58816f4efcf313e54.hot-update.js","sources":["src/app.js"],"sourcesContent":["import express from 'express';\nimport path from 'path';\n// import Sitemap from 'react-router-sitemap';\nimport { isApiExternal } from './net';\nimport modules from './modules';\nimport websiteMiddleware from './middleware/website';\nimport graphiqlMiddleware from './middleware/graphiql';\nimport createGraphServer from './graphql';\nimport errorMiddleware from './middleware/error';\nimport { createStich } from './api/remoteSchema';\n// import Routes from '../../client/src/app/Routes';\n\n// const router = Routes;\n\nconst createExpressApp = async () => {\n  // const savePath = path.join(process.cwd(), 'public');\n  // const sitemapPath = path.join(savePath, 'sitemapTESTING.xml');\n  // const filterConfig = { isValid: false, rules: [/\\/admin/] };\n  // new Sitemap(router)\n  //   .filterPaths(filterConfig)\n  //   .build('https://cahomefitness.com')\n  //   .save(sitemapPath);\n  const app = express();\n\n  for (const applyBeforeware of modules.beforewares) {\n    applyBeforeware(app);\n  }\n  // console.log('TEST::::');\n  // Don't rate limit heroku\n  app.enable('trust proxy');\n\n  const corsOptions = {\n    credentials: true,\n    origin: true\n  };\n\n  for (const applyMiddleware of modules.middlewares) {\n    applyMiddleware(app);\n  }\n\n  if (__DEV__) {\n    app.get('/servdir', (req, res) => {\n      res.send(process.cwd() + path.sep);\n    });\n  }\n\n  if (!isApiExternal) {\n    const graphqlServer = await createGraphServer();\n    graphqlServer.applyMiddleware({\n      app,\n      path: __API_URL__,\n      cors: corsOptions\n    });\n  }\n  await createStich;\n  app.get('/graphiql', (...args) => graphiqlMiddleware(args[0])(...args));\n\n  // For monitoring status\n  app.get('/status', (req, res) => res.status(200).send());\n  app.use((...args) => websiteMiddleware(...args));\n  app.use(express.static('public'));\n\n  app.use(\n    '/',\n    express.static(__FRONTEND_BUILD_DIR__, {\n      maxAge: '180 days'\n    })\n  );\n\n  if (__DEV__) {\n    app.use('/', express.static(__DLL_BUILD_DIR__, { maxAge: '180 days' }));\n    app.use(errorMiddleware);\n  }\n\n  if (module.hot) {\n    module.hot.accept(['./middleware/website', './graphql']);\n  }\n\n  return app;\n};\n\nexport default createExpressApp;\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AARA;AAAA;AAAA;AAAA;AACA;AACA;AAQA;AAAA;AACA;AAAA;AACA;AACA;AACA;AAdA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AADA;AACA;AADA;AAAA;AACA;AADA;AAAA;AACA;AADA;AAeA;AACA;AACA;AACA;AACA;AAFA;AAjBA;AAAA;AAAA;AAAA;AACA;AACA;AAoBA;AAAA;AACA;AAAA;AACA;AACA;AAzBA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AADA;AACA;AADA;AAAA;AACA;AADA;AAAA;AACA;AADA;AA0BA;AACA;AACA;AACA;AACA;AACA;AA/BA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AACA;AADA;AAiCA;AACA;AAAA;AACA;AACA;AACA;AAHA;AACA;AAnCA;AAAA;AAAA;AACA;AADA;AAyCA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AACA;AAGA;AADA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AA/DA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AAkEA;;;;A","sourceRoot":""}